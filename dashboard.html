function printReceipt(data, mode) {
            const container = document.getElementById('print-container');
            container.innerHTML = ""; // Clear

            const createSlip = (titleOverride) => {
                const date = data.date.seconds ? new Date(data.date.seconds * 1000).toLocaleString() : new Date().toLocaleString();
                const isNegative = data.total < 0;
                
                let html = `<div class="receipt">
                    <div class="receipt-center">
                        <div class="receipt-big">${receiptConfig.businessName || "POS"}</div>
                        <div>${(receiptConfig.header || "").replace(/\n/g, '<br>')}</div>
                        <br>
                        ${mode === 'reprint' ? '*** REPRINT ***<br>' : ''}
                        ${mode === 'void' ? '*** VOID SLIP ***<br>' : ''}
                        ${titleOverride ? `*** ${titleOverride} ***<br>` : ''}
                        <div>${date}</div>
                        <div>ID: ${data.id ? data.id.slice(-6) : 'PENDING'}</div>
                    </div>
                    <hr>`;
                
                // Items
                html += data.items.map(i => `
                    <div class="receipt-line">
                        <span>${i.qty}x ${i.name}</span>
                        <span>$${(i.price * i.qty).toFixed(2)}</span>
                    </div>`).join('');
                
                html += `<hr>
                    <div class="receipt-line receipt-bold">
                        <span>TOTAL</span>
                        <span>$${Math.abs(data.total).toFixed(2)} ${isNegative ? '(REFUND)' : ''}</span>
                    </div>
                    <div class="receipt-line">
                        <span>METHOD</span>
                        <span>${data.method || data.paybackMethod}</span>
                    </div>`;

                // --- NEW: Add Details for Card/Check on Reprint ---
                if (data.details) {
                    if (data.method === 'Card' && data.details.txId) {
                         html += `<div class="receipt-line"><span>Tx ID</span><span>${data.details.txId}</span></div>`;
                    }
                    if (data.method === 'Check' && data.details.checkNum) {
                         html += `<div class="receipt-line"><span>Check #</span><span>${data.details.checkNum}</span></div>`;
                    }
                }
                // --------------------------------------------------

                if (mode === 'void' || mode === 'return') {
                    html += `<br><div class="receipt-bold">Reason:</div><div>${data.reason || data.voidReason}</div>`;
                }

                if (mode === 'reprint') {
                    html += `<br><div class="receipt-center">*** REPRINT ***</div>`;
                }

                html += `<br><div class="receipt-center">${(receiptConfig.footer || "").replace(/\n/g, '<br>')}</div>
                </div>`;
                return html;
            };

            if (mode === 'return') {
                container.innerHTML += createSlip("STORE COPY");
                container.innerHTML += createSlip("CUSTOMER COPY");
            } else {
                container.innerHTML += createSlip();
            }

            window.print();
        }
